<!doctype html>
<html><head>
<meta charset="UTF-8">
<title>Tsum Tsum Blast</title>

<script type="text/javascript">

var ctx = null
var drawOffsetX, drawOffsetY
var canvasRect
var mouseHoverPos = null, mouseUpPos = null

var SCALE = 100

function start() 
{
	Module.initStart()
	drawOffsetX = mycanvas.width*0.5
	drawOffsetY = mycanvas.height
	
	requestAnimationFrame(animProgress)
	ctx = mycanvas.getContext('2d')
	
	mycanvas.onmousedown = handleMouseDown
    document.onmouseup = handleMouseUp
    document.onmousemove = handleMouseMove
	
	canvasRect = mycanvas.getBoundingClientRect();

}

function doResize() {
}

function coordFromMouseEvent(event) {
    var cx = event.clientX - canvasRect.left
    var cy = event.clientY - canvasRect.top
    var x = (cx - drawOffsetX) / SCALE
    var y = (cy - drawOffsetY) / -SCALE
    return [x,y]
}
function scrFromCoordX(x) {
    return x * SCALE + drawOffsetX;
}

function scrFromCoordY(y) {
    return y * -SCALE + drawOffsetY;
}

function handleMouseDown(event)
{
}
function handleMouseUp(event)
{
    mouseUpPos = coordFromMouseEvent(event)
}
function handleMouseMove(event)
{
    //console.log("~~ " + x + "  " + y)
    mouseHoverPos = coordFromMouseEvent(event)
}


function animProgress() 
{
    if (mouseHoverPos != null) {
        Module.mouse_hover(mouseHoverPos[0], mouseHoverPos[1])
        mouseHoverPos = null
    }
    if (mouseUpPos != null) {
        Module.mouse_up(mouseUpPos[0], mouseUpPos[1])
        mouseUpPos = null
    }

    Module.cpp_progress()

	ctx.clearRect(0, 0, mycanvas.width, mycanvas.height);
	Module.cpp_draw()
	requestAnimationFrame(animProgress)
}


function drawCircle(x, y, col, radius) 
{
    var sx = scrFromCoordX(x);
    var sy = scrFromCoordY(y);
    var sradius = radius * SCALE
	
	//console.log("~~ " + x + " " + y + "   " + sx + " " + sy)

	ctx.beginPath();
	ctx.arc(sx, sy, sradius, 0, 2 * Math.PI, false)
	ctx.fillStyle = col
	ctx.fill()
	ctx.strokeStyle = '#777777'
	ctx.stroke()
	
}

function dbgPolyStart(x, y) {
    ctx.beginPath()
    var sx = scrFromCoordX(x);
    var sy = scrFromCoordY(y);
    ctx.moveTo(sx, sy);
}
function dbgPolyPoint(x, y) {
    var sx = scrFromCoordX(x);
    var sy = scrFromCoordY(y);
    ctx.lineTo(sx, sy)
}
function dbgPolyEnd() {
    ctx.closePath()
    ctx.strokeStyle = '#ff00ff'
    ctx.stroke()
}


</script>
<script src="js_main.js"></script>
<style>

#mycanvas {
	border: 1px solid black;
}

</style>
</head>
<body id="body" onload="start()" onresize="doResize()" >

	<canvas id="mycanvas" width="800" height="700"></canvas>
	
</body>
</html>